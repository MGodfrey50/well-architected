---
title: Monitoring considerations for Azure VMware Solution workloads
description: See best practices for monitoring Azure VMware Solution workloads at the infrastructure and application levels.
author: Mahesh-MSFT
ms.author: maksh
ms.date: 08/10/2023
ms.topic: conceptual
ms.service: waf
ms.subservice: waf-workload-avs
---

# Monitoring considerations for Azure VMware Solution workloads

This article identifies the monitoring requirements of the Azure VMware Solution.  The guidance is intended for the operations team responsible for managing and maintaining the infrastructure and health of the environment. The focus is on what to monitor with guidance based on Microsoft and VMware native tools, however 3rd party tools can of course be used as alternatives.
Solution components that write to the VMware syslog include VMware ESXi, VMware vSAN, VMware NSX-T Data Center, and VMware vCenter Server.   When Diagnostics is enabled, those logs are written to the designated Log Analytics Workspace.


## Basic Health

*Impact: Operational excellence*

### Host Operations:
Ensure you are aware of pending host operations by setting up the notifications for host remediation activities (changes to underlying hardware).  

##### Recommendations

- You must be added to any one of the following RBAC roles in all subscriptions where an Azure VMware Solution is deployed.  Co-Administrator, Owner or Contributor or Service Administrator (Classic administrators).  
Ref: [Host Actions Notification](https://learn.microsoft.com/en-us/azure/azure-vmware/concepts-private-clouds-clusters#host-monitoring-and-remediation)

### Host monitoring and remediation:  

Understanding what Microsoft is doing as part of normal cloud operations to the Azure VMware environment requires you to configure the ‘Service Health’ monitoring function.  This service notifies you use ‘Alerts’ via  ‘Action Groups’ about service events. Make sure you add all the regions where you have the Azure VMware Solution deployed the select the four options ‘Service issue, planned maintenance, health advisories and security advisories’.  Divide these up to target specific operations teams as required.

#### Recommendation: 

- Enable health alerts and identify owners for each of the four alert types.     
Ref: [Service Health Alerts For Azure VMware Solution](https://learn.microsoft.com/en-us/azure/azure-vmware/configure-alerts-for-azure-vmware-solution)     
Ref: Integrating with VMware Aria Operation [Configuring an Azure VMware Solution Instance in VMware Aria Operations](https://docs.vmware.com/en/VMware-Aria-Operations/8.16/Configuring-Operations/GUID-6CDFEDDC-A72C-4AB4-B8E8-84542CC6CE27.html)


### Host performance and metrics: 
Use the monitoring metrics available in Azure to watch for threshold consumption levels of CPU, memory and storage that exceed recommendations. To obtain the logs, the ‘Diagnostics’ options must be configured for each SDDC.
You can also integrate the Azure VMware Solution with VMware Aria (separate service with its own licencing) to get performance optimization, efficient capacity and cost management, intelligent remediation, and integrated compliance. Azure Diagnostics can also be used to send logs to third party logging solutions using event hubs, storage accounts or directly to a supported partner solution.
#### 	Recommendation: 
- Enable the Azure VMware Solution performance metrics monitoring capabilities manually from the portal, using Bicep, Powershell, Terraform or the Azure CLI. 
- Leverage tools like VMware Aria to gather performance metrics.    
Ref:  Githup automated deployment of key metrics [Key monitoring metrics](https://github.com/Azure/Enterprise-Scale-for-AVS/blob/main/BrownField/PrivateCloud/AVS-PrivateCloud/readme.md)

### SDDC NSX-T monitoring: 
To access network logs , enable the Azure VMware Diagnostics options and send data to the designated Log Analytics Workspace.  This will enable access to the health data from the NSX_T appliances and to logs that the VMware syslog service collects. 
#### Recommendations:
- Enable the Azure VMware Solution ‘Diagnostics’ settings to send the logs to the custom Log Analytics Workspace.    
Ref: Configure VMware syslogs for Azure VMware Solution [NSX-T Logging](https://learn.microsoft.com/en-us/azure/azure-vmware/configure-vmware-syslogs)     
Ref: Enable tagging on NSX-T Firewall rules and SNAT rules to facilitate searches in Azure Log Analytics. [Configuring NSX-T Firewall Rules Logging](https://techcommunity.microsoft.com/t5/azure-migration-and/azure-vmware-solution-using-log-analytics-with-nsx-t-firewall/ba-p/4131302)     
(Note: Logging must be enabled for rules defined in NSX-T before they appear in the Azure log analytics workspace.  Logs generated by vCenter are sent automatically.)



## Managing Logs - Retention & Archive

*Impact: Operational excellence*

Azure Log Analytics allows you to store logs for up to 2 years.  An analysis of your log retention requirements should be done to identify which logs are required for longer term storage and/or which logs can be retained in a less expensive archive. If you have record immutability requirements, Azure VMware Solution diagnostics settings allow you to send the logs to an Azure native storage blob.  You can use tools such as Azure Logic Apps or Azure Functions to forward logs. You can use these tools to create listeners for incoming logs from Azure VMware Solution and to send the logs to a storage blob.

Archiving logs is a strategy for keeping your storage costs down. Azure Storage blobs and Log Analytics can transfer logs for long-term archival. Using a storage blob is the less expensive option. But Log Analytics has advanced integrations for alerting, visualization, querying, and gaining machine learning–based insights. Consider your budget, functional use cases, and long-term use cases when you choose a solution.


##### Recommendations

- Collect logs from the VMware syslog service to get health data from VMware solution components such as VMware ESXi, VMware vSAN, VMware NSX-T Data Center, and VMware vCenter Server.     
Ref: Configuring Log Analytics [Enabling Diagnostics For Azure VMware Solution](https://learn.microsoft.com/en-us/azure/azure-vmware/configure-vmware-syslogs)
- Configure tools such as VMware Aria Operations for Logging to collect various logs for querying, analyzing, and reporting capabilities.
- Configure retention durations for sending logs to long-term storage to reduce query time and save on storage costs.    
Ref: Log retention [Configure Log Retention & Archive](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/data-retention-archive?tabs=portal-3%2Cportal-1%2Cportal-2)     
Ref: Log immutability [Securing logs](https://learn.microsoft.com/en-us/azure/storage/blobs/immutable-policy-configure-version-scope)     
Ref: Storing logs off-line [Long Term Retention Using Azure Storage](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/logs-export-logic-app)
  


## Monitor the guest operating system

*Impact: Operational excellence*

Monitor the performance on individual virtual machines running in the Azure VMware Solution platform for key metrics like RAM, CPU, disk consumption and other resources.  Create custom dashboards to monitor the state of your virtual machines.

Use Azure ARC for Azure VMware Solution or Azure ARC for Servers to monitor an manage guest virtual machines.  Note that for software running in a virtual machine (VM) like, SQL Server and Windows Server, running in Azure VMware Solution provides more value such as free Extended Security Updates (ESUs).

You can continue to use 3rd party or legacy tools to monitor guest VM performance metrics however note that these logs will not be kept in the Log Analytics Workspace.

#### Recommendations:

- Compare the features then deploy the Azure ARC for Azure VMware Solution, or Azure ARC for Servers, and connect virtual machines performance metrics.    
Ref: Azure ARC for Azure VMware Solution [Deploy ARC For Azure VMware Solution](https://learn.microsoft.com/en-us/azure/azure-vmware/deploy-arc-for-azure-vmware-solution?tabs=windows)      
Ref: Azure ARC for Servers [ARC For Servers](https://learn.microsoft.com/en-us/azure/azure-arc/servers/overview)
- Set alerts for specific thresholds based on machine roles and requirements.     
Ref: VM Metrics [Enable Monitoring of Hybrid Workloads](https://learn.microsoft.com/en-us/azure/azure-arc/servers/learn/tutorial-enable-vm-insights)
- Use Azure policy to collect only the logs you need to control costs.     
Ref: Azure Policy for cost control [Cost Governance](https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/cost-governance-with-azure-policy/ba-p/3791888#:~:text=With%20Azure%20Policy%2C%20you%20can%20define%20and%20enforce,to%20resources%20that%20identify%20them%20as%20cost-related%20resources.)
- Use monitoring alerts to notify operations of resource constrained workloads.    
Ref: Alerting [Automated Deployment Of Default Metric Alerts](https://github.com/Azure/Enterprise-Scale-for-AVS/tree/main/BrownField)
- Create dashboard to visually represent key metrics of your workloads across SDDCs.    
Ref: Creating dashboards [Azure Dashboard Creation](https://learn.microsoft.com/en-us/azure/azure-portal/azure-portal-dashboards)

## Monitoring networks

*Impact: Security, Operational excellence*

There are two networks to monitor with an Azure VMware Solution SDDC; the traffic in Azure native and the traffic within the SDDC itself.  

For the Azure to SDDC traffic, ensuring that connectivity is available, and alerting when it is not, is accomplished by setting up network monitoring jobs using Network Monitor.  This can be configured either as a one-off (troubleshooting) or as an ongoing tool to identify communication issues.

For connectivity between workloads within the SDDC, port mirroring is intended to be used as a temporary investigative tool and not a permanent network data collection feature. For a continuous meta-data network flow logging solution use the IPFix feature.

As described above in SDDC NSX-T monitoring , leverage the ability to log network rules defined in the NSX-T/Security and NSX-T/Networking/NAT portals.  Use descriptive tagging in both areas to facilitate searching and alerting through log analytics.


#### Recommendations:

- Set up Azure Monitor Network Insights to monitor the connectivity and throughput between the Azure segments of you Azure VMware Solution environment.    
Ref: Network connectivity monitoring [Network Watcher](https://learn.microsoft.com/en-us/azure/network-watcher/network-insights-overview)

- Enable diagnostics and leverage log analytics to create dashboards and alerts on your network connections supporting the Azure VMware Solution.    
Ref: Log analytics [Creating Dashboards](https://learn.microsoft.com/en-us/azure/azure-monitor/visualize/tutorial-logs-dashboards)

- Use VMware Aria (formerly vRealize) to monitor network connections.     
Ref:  Using Aria [Configuring VMware Aria](https://learn.microsoft.com/en-us/azure/azure-vmware/vrealize-operations-for-azure-vmware-solution)

- Use Azure Firewall Workbook or similar tools to monitor common metrics and logs that are related to firewall devices.    
Ref: Azure Firewall Workbook [Using The Azure Firewall Workbook](https://learn.microsoft.com/en-us/azure/firewall/firewall-workbook)     
Ref: Using Azure Kusto query language [Azure Firewall Structured Logs](https://learn.microsoft.com/en-us/azure/firewall/firewall-structured-logs)

- Use Azure Log Analytics Kusto query language to correlate logs from multiple security vectors such as identity, networking, and infrastructure vectors.  Leverage the pre-built queries (viewable when you open the Log Analytics blade) as a starting point and develop your own as required.   
Ref: Getting started with Kusto [Introduction To Kusto Query Language](https://techcommunity.microsoft.com/t5/azure-synapse-analytics-blog/introduction-to-kusto-query-language-kql/ba-p/3758349)     
Ref: Kusto Overview [KQL Overview](https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/)

- Capture and monitor network firewall logs that are deployed in the Azure VMware Solution private cloud. Also monitor logs that are deployed in Azure when your application extends to Azure native devices such as Azure Firewall or Azure Application Gateway.     
Ref: Azure Firewall & Azure VMware Solution [Firewall Integration In Azure VMware Solution](https://techcommunity.microsoft.com/t5/azure-migration-and/firewall-integration-in-azure-vmware-solution/ba-p/2254961)


## Securing Azure VMware Solution

*Impact: Security, Operational excellence*

Use a defence in depth approach to secure your SDDC by deploying best practices and tools to protect against and monitor for anomalous behavior. 

Secure your networks by using firewalls with WAF capability both inside and external to the Azure VMware Solution.   Azure Firewall or a 3rd party NVA should be deployed to protect North/South traffic (in and out of the SDDC) and either NSX-T Firewall or a 3rd party NVA should be used inside the SDDC for East/West traffic (between workloads within the SDDC).

Enable Microsoft Defender for Cloud (requires Azure Arc) to protect workloads against threats to servers running in the SDDC.  3rd party solutions can also be used here.

Enable a cloud native security information and event management (SIEM) and security orchestration, automation, and response (SOAR) solution that runs in the Azure cloud to deliver intelligent security analytics and threat intelligence across all workloads in the SDDC.
#### Recommendations:
- Create a zero trust business plan and implement it.      
Ref: Zero Trust [Business Plan](https://query.prod.cms.rt.microsoft.com/cms/api/am/binary/RWJtxq)

- Leverage defensive and investigative tools to provide a complete defence in depth approach to workload security. These can be either Microsoft cloud native tools like Defender/Sentinel/Network Manager, or 3rd party tools from Microsoft partners.    
Ref: Zero Trust [Networking](https://learn.microsoft.com/en-us/security/zero-trust/deploy/networks)

-  Secure your networks using Azure Firewall or an NVA based on zero trust networking concepts and use the WAF filtering capabilities of next generation firewalls.     
Ref: Zero Trust [Azure Firewall](https://learn.microsoft.com/en-us/azure/firewall/overview)

- Configuring Azure Defender for Servers      
Ref: Securing virtual machines [Defender For Servers](https://learn.microsoft.com/en-us/azure/defender-for-cloud/plan-defender-for-servers-agents)

- Enable a SIEM/SOAR solution like Azure Sentinel or a third party tool.     
Ref: SIEM/SOAR  [Azure Sentinal](https://learn.microsoft.com/en-us/azure/sentinel/quickstart-onboard)


## Storage	

Azure VMware Solution supports the addition of extra storage via cloud native partnerships with NetApp and Purestorage as well as the new Azure Native ElasticSAN.  Each of these has specific properties that allow customers to meet workload specific requirements, and each of then needs to be monitored. 

Diagnostics enable monitoring of the capacity of datastores added to the SDDC for each of the forementioned solution.  You should also be monitoring connectivity and performance based on each systems metrics – all these are enabled through the Diagnostics settings in their respective blades (Azure portal page).

Recommendations:
- For each additional datastore added to your SDDCs enable diagnostics, connectivity monitoring and capacity monitoring.   
Ref: Monitor Azure NetApp Files [ANF Monitoring](https://learn.microsoft.com/en-us/azure/azure-netapp-files/monitor-azure-netapp-files)
	
- Monitoring NetApp Certificate Rotation because Automatic Managed System Identity (MSI) certificate renewal isn't currently supported. It's recommended you create an Azure monitor alert to notify you when the MSI certificate is set to expire.     
Ref:  Monitor Azure NetApp files certificate rotation [Monitoring ANF Certificate Expiry](https://learn.microsoft.com/en-us/azure/azure-netapp-files/configure-customer-managed-keys?tabs=azure-portal#considerations)
- Monitor datastore capacity [Datastore Alerting](https://github.com/Azure/Enterprise-Scale-for-AVS/blob/main/BrownField/Monitoring/AVS-Utilization-Alerts/readme.md)


## Configure and streamline alerts

When you run workloads in the Azure VMware Solution private cloud, you need to effectively monitor workload performance. For example, you should capture logs, metrics, and trace requests for your application and infrastructure layers.

Alerts can help you respond to changes in your performance baseline. You can also use alerts to provide information about necessary maintenance or configuration changes. For instance, you can receive notifications when a key expires, a connection is lost, or there's a risk of exceeding a resource's capacity.

To make alerts effective, configure them to notify accountable teams when certain conditions are met. Also consider consolidating alerts to reduce the number of individual notifications that are sent:    

- Instead of issuing an alert for every machine that's low on space, consider consolidating alerts by hosts, resource groups, or clusters.
- Use this approach also with host issues, CPU, and storage spikes.
- Base alerts on time windows. For example, if a host issues alerts for a short time, you can suppress the alerts according to a defined time threshold. For instance, you can send an alert only after five minutes have passed.

#### Recommendations
- Discuss and establish baselines that are based on performance data.    
Ref: Azure Monitor Baseline [Configure Baseline Alerts](https://azure.github.io/azure-monitor-baseline-alerts/welcome/)

- Define relevant alert criteria such as thresholds, severity levels, or specific conditions.    
Ref: Azure Monitor Alerts [Managing Alerts in Azure](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-manage-alert-rules)
- Use the VMware vSphere events and alarms subsystem to monitor VMware vSphere and set up triggers.     
Ref: Complex solution - require the use of PowerCLI and/or the API (documentation pending)
- Configure Azure alerts in Azure VMware Solution to respond to events in real time.     
Ref: Configuraing Azure Alerts [Azure VMare Solution Alerts](https://learn.microsoft.com/en-us/azure/azure-vmware/configure-alerts-for-azure-vmware-solution)
- Use application performance monitoring (APM) tools to gain performance insights at the application code level.    
Ref: Hybrid Use of [Application Insights](https://learn.microsoft.com/en-us/azure/architecture/hybrid/hybrid-perf-monitoring)
- Use a combination of monitoring techniques such as synthetic transactions, heartbeat monitoring, and endpoint monitoring.     
Ref: End-to-end monitoring [Hybrid Monitoring](https://learn.microsoft.com/en-us/azure/architecture/hybrid/hybrid-perf-monitoring)
- Prioritize alerts based on their impact on operations or the criticality of the affected systems. Fine-tune alerts to trigger only meaningful events.     
Ref: Actions on alerting [Plan Alerts & Automated Actions](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-plan)
- To reduce noise and effectively manage alerts, use methods for reducing the number of individual notifications that are issued.     
Ref: Setting dynamic alert thresholds [Dynamic Monitoring](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-dynamic-thresholds)
- To minimize alert fatigue, employ a mechanism to notify key stakeholders only about significant events.     
Ref:  Managing alert rules [Alert Rule Management](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-manage-alert-rules)
- Use notification channels such as SMS, email, push notifications, and collaboration platforms such as Microsoft Teams to ensure that alerts are delivered effectively.     
Ref: Notifications and actions [Azure Action Groups](https://learn.microsoft.com/en-us/azure/azure-monitor/alerts/action-groups)




## Manage costs

*Impact: Cost optimization, Operational excellence*

Cost monitoring refers to the ability to keep track of costs that are associated with the Azure VMware Solution private cloud. Be familiar with how Azure costs are incurred, the on-line cost estimation calculator, and the tools available through the portal.  Use the cost analysis tool to create complete cost models that encompass all the Azure components related to a project or service. 

##### Recommendations

- Read the Azure cost monitoring documentation.    
Ref: Cost Management [Azure Costs & Billing](https://learn.microsoft.com/en-us/azure/cost-management-billing/understand/plan-manage-costs)
- Create alerts based on actual vs. budget     
Ref: Azure budget alerts [Monitoring Costs](https://learn.microsoft.com/en-us/azure/cost-management-billing/costs/cost-mgt-alerts-monitor-usage-spending)
- Use the visualization and costing management tools     
Ref: Cost Analysis [Quick Cost Analysis](https://learn.microsoft.com/en-us/azure/cost-management-billing/costs/quick-acm-cost-analysis)



## Dashboards

*Impact: Operational excellence*

Application dashboards help you visualize and monitor an application's performance, health, and other metrics. 

Monitoring reports in dashboards help you do root-cause analysis and troubleshooting quickly. Operations teams can use these dashboards to view all key resources that make up Azure VMware Solution in a single pane. Dashboard metrics provide insight into how code and infrastructure changes impact application behavior.  Theses visuals help customer support teams understand the impact of changes, performance, and availability issues on an application.

Performance indicators benefit executive leadership and business stakeholders. These tools inform decisions that align an application's performance with business objectives. For example, an executive can monitor commitment to customers by reviewing metrics such as service availability, incident resolution times, and average response times. These metrics help ensure that the organization delivers services according to its SLA.

Besides offering insight, dashboards can also promote transparency and encourage collaboration, for instance, when you grant appropriate stakeholders access to application dashboards. This act cultivates a shared comprehension of an application's performance. This practice also enables an organization to make informed decisions. As a result, stakeholders can focus on pursuing crucial initiatives that propel the business forward.

Fundamentally workbooks provide richer functionality, while dashboards offer a "single pane of glass" view of Azure infrastructure and services.

##### Recommendations

- Build an application dashboard with Application Insights or Grafana. Connect the dashboard to relevant data sources that store metrics from your Azure VMware Solution environment.   
Ref: Building Azure dashboard [Create A Dashboard](https://learn.microsoft.com/en-us/azure/azure-portal/azure-portal-dashboards)
- Create an Azure workbook as a central repository for commonly run queries, metrics, and interactive reports.     
Ref: Building workbooks [Create An Azure Workbook](https://learn.microsoft.com/en-us/azure/azure-monitor/visualize/workbooks-create-workbook)
- Ensure that your resources align with security and compliance requirements defined in Azure Policy.    
Ref: Monitoring compliance [Azure Policy & Compliance](https://learn.microsoft.com/en-us/azure/governance/policy/how-to/determine-non-compliance)


## Next steps

Now that you've looked at observability best practices in Azure VMware Solution, explore mechanisms, tools, and perimeters that you can use to further secure workloads in the SDDC.

> [!div class="nextstepaction"]
> [Security](./security.md)

Use the assessment tool to evaluate your design choices.

> [!div class="nextstepaction"]
> [Assessment](./assessment.md)